#!/bin/bash

# Final DNS Dig + Network Booster Script
# Banner: JUMAWAN WEEWKING

# Color Codes
YELLOW='\033[1;33m'
RED='\033[1;31m'
NC='\033[0m' # No Color

# Banner
clear
echo -e "${YELLOW}"
echo "██╗░░░░░░█████╗░░█████╗░███████╗"
echo "██║░░░░░██╔══██╗██╔══██╗██╔════╝"
echo "██║░░░░░██║░░██║██║░░██║█████╗░░"
echo "██║░░░░░██║░░██║██║░░██║██╔══╝░░"
echo "███████╗╚█████╔╝╚█████╔╝███████╗"
echo "╚══════╝░╚════╝░░╚════╝░╚══════╝"
echo -e "${RED}Powered by JUMAWAN WEEWKING${NC}"
echo ""

# Files
NS_FILE="$HOME/.ns_list.txt"
touch $NS_FILE
BASHRC_FILE="$HOME/.bashrc"
SCRIPT_PATH="$HOME/dns_autodig.sh"

# Dependency Check
if ! command -v dig &> /dev/null; then
    echo "Installing dnsutils..."
    pkg install dnsutils -y
fi

# Booster Loop
network_booster() {
    while true; do
        ping -c 1 1.1.1.1 > /dev/null
        sleep 30
    done
}
network_booster &
BOOSTER_PID=$!

# Wake Lock
termux-wake-lock

# Functions
add_ns() {
    echo -n "Enter NS: "
    read ns
    echo $ns >> $NS_FILE
    echo "Added: $ns"
}

check_ns() {
    echo "NS List:"
    cat $NS_FILE
}

delete_ns() {
    echo "NS List:"
    nl $NS_FILE
    echo -n "Delete line number: "
    read del
    sed -i "${del}d" $NS_FILE
    echo "Deleted."
}

start_dig_loop() {
    while true; do
        for ns in $(cat $NS_FILE); do
            dig @$ns google.com | grep -i "status"
        done
        sleep 5
    done
}

autorun_start() {
    if grep -Fxq "bash $SCRIPT_PATH" $BASHRC_FILE; then
        echo "Autorun is already enabled."
    else
        echo "bash $SCRIPT_PATH" >> $BASHRC_FILE
        echo "Autorun has been enabled."
    fi
}

autorun_stop() {
    sed -i "/bash \$HOME\/dns_autodig.sh/d" $BASHRC_FILE
    echo "Autorun has been disabled."
}

autorun_status() {
    if grep -Fxq "bash $SCRIPT_PATH" $BASHRC_FILE; then
        echo "Autorun is ENABLED."
    else
        echo "Autorun is DISABLED."
    fi
}

# Menu
while true; do
    echo -e "${YELLOW}==========================${NC}"
    echo -e "${YELLOW}[1] Add NS${NC}"
    echo -e "${YELLOW}[2] Check NS${NC}"
    echo -e "${YELLOW}[3] Delete NS${NC}"
    echo -e "${YELLOW}[4] Start Dig Loop${NC}"
    echo -e "${YELLOW}[5] Autorun Start${NC}"
    echo -e "${YELLOW}[6] Autorun Stop${NC}"
    echo -e "${YELLOW}[7] Autorun Status${NC}"
    echo -e "${YELLOW}[8] Exit${NC}"
    echo -e "${YELLOW}==========================${NC}"
    echo -n "Choose an option: "
    read choice
    case $choice in
        1) add_ns ;;
        2) check_ns ;;
        3) delete_ns ;;
        4) start_dig_loop ;;
        5) autorun_start ;;
        6) autorun_stop ;;
        7) autorun_status ;;
        8) kill $BOOSTER_PID; termux-wake-unlock; exit ;;
        *) echo "Invalid option." ;;
    esac
done
